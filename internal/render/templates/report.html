<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR Log - shiraberu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    {{template "styles" .}}
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>PR Log</h1>
            <div class="meta">
                {{.PeriodLabel}} Â· Org: @{{.Report.Org}} Â· User: @{{.Report.Username}}
            </div>
        </div>
        <button id="downloadBtn" class="download-btn" title="Download HTML">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 12l-4-4h2.5V3h3v5H12L8 12z"/>
                <path d="M14 13v1H2v-1h12z"/>
            </svg>
            Download
        </button>
    </div>

    {{if .Report.Days}}
    {{if ne .OriginalStartDate .OriginalEndDate}}
    <div class="date-filter">
        {{if or (gt (len .WeeklyStats) 1) (gt (len .MonthlyStats) 1)}}
        <div class="filter-tabs">
            <button class="filter-tab active" data-mode="day">Day</button>
            {{if gt (len .WeeklyStats) 1}}<button class="filter-tab" data-mode="week">Week</button>{{end}}
            {{if gt (len .MonthlyStats) 1}}<button class="filter-tab" data-mode="month">Month</button>{{end}}
        </div>
        {{end}}
        <div class="filter-content">
            <div class="filter-mode" id="dayMode">
                <select id="filterStartDate"></select>
                <span>â€”</span>
                <select id="filterEndDate"></select>
            </div>
            {{if gt (len .WeeklyStats) 1}}
            <div class="filter-mode" id="weekMode" style="display:none;">
                <select id="weekSelect"></select>
            </div>
            {{end}}
            {{if gt (len .MonthlyStats) 1}}
            <div class="filter-mode" id="monthMode" style="display:none;">
                <select id="monthSelect"></select>
            </div>
            {{end}}
        </div>
        <span class="filter-info"><span id="daysCount"></span></span>
    </div>
    {{end}}

    {{if gt (len .RepoStats) 1}}
    <div class="repo-filter">
        <select id="repoSelect" class="repo-select">
            <option value="">All Repositories</option>
            {{range .RepoStats}}
            <option value="{{.Repository}}">{{.Repository}} ({{.Count}})</option>
            {{end}}
        </select>
        <span class="repo-filter-info"><span id="repoCount">{{len .RepoStats}}</span> repos</span>
    </div>
    {{end}}

    <div class="summary" id="summaryContainer">
        <div class="summary-item">
            <span class="summary-value opened">{{.Summary.OpenedCount}}</span>
            {{if .SummaryDiff.HasPrevious}}
            <span class="summary-diff {{if gt .SummaryDiff.OpenedDiff 0}}positive{{else if lt .SummaryDiff.OpenedDiff 0}}negative{{else}}neutral{{end}}">
                {{if gt .SummaryDiff.OpenedDiff 0}}â†‘ +{{.SummaryDiff.OpenedDiff}}{{else if lt .SummaryDiff.OpenedDiff 0}}â†“ {{.SummaryDiff.OpenedDiff}}{{else}}â†’ 0{{end}}
            </span>
            {{end}}
            <span class="summary-label">Opened</span>
        </div>
        <div class="summary-item">
            <span class="summary-value draft">{{.Summary.DraftCount}}</span>
            {{if .SummaryDiff.HasPrevious}}
            <span class="summary-diff {{if gt .SummaryDiff.DraftDiff 0}}positive{{else if lt .SummaryDiff.DraftDiff 0}}negative{{else}}neutral{{end}}">
                {{if gt .SummaryDiff.DraftDiff 0}}â†‘ +{{.SummaryDiff.DraftDiff}}{{else if lt .SummaryDiff.DraftDiff 0}}â†“ {{.SummaryDiff.DraftDiff}}{{else}}â†’ 0{{end}}
            </span>
            {{end}}
            <span class="summary-label">Draft</span>
        </div>
        <div class="summary-item">
            <span class="summary-value merged">{{.Summary.MergedCount}}</span>
            {{if .SummaryDiff.HasPrevious}}
            <span class="summary-diff {{if gt .SummaryDiff.MergedDiff 0}}positive{{else if lt .SummaryDiff.MergedDiff 0}}negative{{else}}neutral{{end}}">
                {{if gt .SummaryDiff.MergedDiff 0}}â†‘ +{{.SummaryDiff.MergedDiff}}{{else if lt .SummaryDiff.MergedDiff 0}}â†“ {{.SummaryDiff.MergedDiff}}{{else}}â†’ 0{{end}}
            </span>
            {{end}}
            <span class="summary-label">Merged</span>
        </div>
        <div class="summary-item">
            <span class="summary-value reviewed">{{.Summary.ReviewedCount}}</span>
            {{if .SummaryDiff.HasPrevious}}
            <span class="summary-diff {{if gt .SummaryDiff.ReviewedDiff 0}}positive{{else if lt .SummaryDiff.ReviewedDiff 0}}negative{{else}}neutral{{end}}">
                {{if gt .SummaryDiff.ReviewedDiff 0}}â†‘ +{{.SummaryDiff.ReviewedDiff}}{{else if lt .SummaryDiff.ReviewedDiff 0}}â†“ {{.SummaryDiff.ReviewedDiff}}{{else}}â†’ 0{{end}}
            </span>
            {{end}}
            <span class="summary-label">Reviewed</span>
        </div>
        <div class="summary-item">
            <span class="summary-value changes"><span class="stat-add">+{{.Summary.Additions}}</span> <span class="stat-del">âˆ’{{.Summary.Deletions}}</span></span>
            <span class="summary-label">Merged</span>
        </div>
    </div>

    {{if gt (len .DailyStats) 1}}
    <div class="charts-section">
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Activity</div>
                {{if or (gt (len .WeeklyStats) 1) (gt (len .MonthlyStats) 1)}}
                <div class="chart-tabs">
                    <button class="chart-tab active" data-period="daily">Day</button>
                    {{if gt (len .WeeklyStats) 1}}<button class="chart-tab" data-period="weekly">Week</button>{{end}}
                    {{if gt (len .MonthlyStats) 1}}<button class="chart-tab" data-period="monthly">Month</button>{{end}}
                </div>
                {{end}}
            </div>
            <div class="chart-wrapper">
                <canvas id="activityChart"></canvas>
            </div>
        </div>
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Merged Repository Activity</div>
            </div>
            <div class="chart-wrapper">
                <canvas id="repoActivityChart"></canvas>
            </div>
        </div>
    </div>
    {{end}}

    <div class="toggle-controls">
        <button class="toggle-btn" onclick="toggleAll(true)">Open All</button>
        <button class="toggle-btn" onclick="toggleAll(false)">Close All</button>
    </div>
    {{end}}

    {{if not .Report.Days}}
    <div class="empty">No pull requests found</div>
    {{else}}
    {{range $index, $day := .Report.Days}}
    {{$totalPRs := len .Opened | add (len .Draft) | add (len .Merged) | add (len .Reviewed)}}
    <details class="day">
        <summary>
            <span class="day-header">{{.Date.Format "2006-01-02"}} ({{index $.Weekdays .Date.Weekday}})</span>
            <span class="day-count">{{$totalPRs}} PRs</span>
        </summary>
        <div class="day-content">
            {{if .Opened}}
            <div class="category">
                <div class="category-title opened">Opened</div>
                <ul class="pr-list">
                    {{range .Opened}}
                    <li class="pr-item">
                        <a href="{{.URL}}" class="pr-link" target="_blank">{{.Title}}</a>
                        <div class="pr-meta">
                            <span class="pr-repo">{{.Repository}}</span>
                            <span class="state state-open">Open</span>
                            <span class="pr-stats">
                                <span class="stat-add">+{{.Additions}}</span>
                                <span class="stat-del">âˆ’{{.Deletions}}</span>
                                {{if .Comments}}<span class="stat-comments">ðŸ’¬ {{.Comments}}</span>{{end}}
                            </span>
                        </div>
                    </li>
                    {{end}}
                </ul>
            </div>
            {{end}}

            {{if .Draft}}
            <div class="category">
                <div class="category-title draft">Draft</div>
                <ul class="pr-list">
                    {{range .Draft}}
                    <li class="pr-item">
                        <a href="{{.URL}}" class="pr-link" target="_blank">{{.Title}}</a>
                        <div class="pr-meta">
                            <span class="pr-repo">{{.Repository}}</span>
                            <span class="state state-draft">Draft</span>
                            <span class="pr-stats">
                                <span class="stat-add">+{{.Additions}}</span>
                                <span class="stat-del">âˆ’{{.Deletions}}</span>
                                {{if .Comments}}<span class="stat-comments">ðŸ’¬ {{.Comments}}</span>{{end}}
                            </span>
                        </div>
                    </li>
                    {{end}}
                </ul>
            </div>
            {{end}}

            {{if .Merged}}
            <div class="category">
                <div class="category-title merged">Merged</div>
                <ul class="pr-list">
                    {{range .Merged}}
                    <li class="pr-item">
                        <a href="{{.URL}}" class="pr-link" target="_blank">{{.Title}}</a>
                        <div class="pr-meta">
                            <span class="pr-repo">{{.Repository}}</span>
                            <span class="state state-merged">Merged</span>
                            <span class="pr-stats">
                                <span class="stat-add">+{{.Additions}}</span>
                                <span class="stat-del">âˆ’{{.Deletions}}</span>
                                {{if .Comments}}<span class="stat-comments">ðŸ’¬ {{.Comments}}</span>{{end}}
                            </span>
                        </div>
                    </li>
                    {{end}}
                </ul>
            </div>
            {{end}}

            {{if .Reviewed}}
            <div class="category">
                <div class="category-title reviewed">Reviewed</div>
                <ul class="pr-list">
                    {{range .Reviewed}}
                    {{template "pr-item" .}}
                    {{end}}
                </ul>
            </div>
            {{end}}
        </div>
    </details>
    {{end}}
    {{end}}

    {{if .Report.Days}}
    {{template "scripts" .}}
    {{end}}
</body>
</html>
